{% extends "base.html" %}

{% block title %}Configuration - ICS to Google Calendar Sync{% endblock %}

{% block content %}
<div class="card">
    <h2>Configuration</h2>
    
    <form method="POST" action="{{ url_for('config') }}">
        <div class="form-group">
            <label for="ics_url">ICS Calendar URL</label>
            <input type="url" id="ics_url" name="ics_url" 
                   value="{{ config.ics_url }}" 
                   placeholder="https://example.com/calendar.ics" 
                   required>
            <p class="help-text">Enter the URL of the ICS calendar feed you want to sync from.</p>
        </div>
        
        <div class="form-group">
            <label for="calendar_id">Google Calendar ID</label>
            <input type="text" id="calendar_id" name="calendar_id" 
                   value="{{ config.calendar_id or 'primary' }}" 
                   placeholder="primary" 
                   required>
            <p class="help-text">
                Enter 'primary' for your main calendar, or the calendar ID (e.g., 'abc123@group.calendar.google.com').
                You can find calendar IDs in Google Calendar settings.
            </p>
        </div>
        
        <div class="form-group">
            <label for="sync_interval">Sync Interval (seconds)</label>
            <input type="number" id="sync_interval" name="sync_interval" 
                   value="{{ config.sync_interval or 900 }}" 
                   min="60" 
                   step="60"
                   required>
            <p class="help-text">
                How often to sync the calendar (in seconds). Default is 900 seconds (15 minutes).
                Minimum is 60 seconds (1 minute).
            </p>
        </div>
        
        <div class="form-group">
            <label for="full_sync_hour">Full Sync Hour (0-23)</label>
            <input type="number" id="full_sync_hour" name="full_sync_hour" 
                   value="{{ config.full_sync_hour if config.full_sync_hour is defined else 0 }}" 
                   min="0" 
                   max="23"
                   required>
            <p class="help-text">
                Hour of day (0-23) when the full sync runs. Default is 0 (midnight). Quick syncs (7 days) run at the regular interval.
            </p>
        </div>
        
        <div class="form-group">
            <label for="full_sync_timezone">Full Sync Timezone</label>
            <select id="full_sync_timezone" name="full_sync_timezone" required>
                {% set current_tz = config.full_sync_timezone or 'UTC' %}
                <option value="UTC" {% if current_tz == 'UTC' %}selected{% endif %}>UTC</option>
                <optgroup label="America">
                    <option value="America/New_York" {% if current_tz == 'America/New_York' %}selected{% endif %}>America/New_York (Eastern)</option>
                    <option value="America/Chicago" {% if current_tz == 'America/Chicago' %}selected{% endif %}>America/Chicago (Central)</option>
                    <option value="America/Denver" {% if current_tz == 'America/Denver' %}selected{% endif %}>America/Denver (Mountain)</option>
                    <option value="America/Phoenix" {% if current_tz == 'America/Phoenix' %}selected{% endif %}>America/Phoenix (MST - no DST)</option>
                    <option value="America/Los_Angeles" {% if current_tz == 'America/Los_Angeles' %}selected{% endif %}>America/Los_Angeles (Pacific)</option>
                    <option value="America/Anchorage" {% if current_tz == 'America/Anchorage' %}selected{% endif %}>America/Anchorage (Alaska)</option>
                    <option value="America/Honolulu" {% if current_tz == 'America/Honolulu' %}selected{% endif %}>America/Honolulu (Hawaii)</option>
                    <option value="America/Toronto" {% if current_tz == 'America/Toronto' %}selected{% endif %}>America/Toronto</option>
                    <option value="America/Vancouver" {% if current_tz == 'America/Vancouver' %}selected{% endif %}>America/Vancouver</option>
                    <option value="America/Mexico_City" {% if current_tz == 'America/Mexico_City' %}selected{% endif %}>America/Mexico_City</option>
                    <option value="America/Sao_Paulo" {% if current_tz == 'America/Sao_Paulo' %}selected{% endif %}>America/Sao_Paulo</option>
                    <option value="America/Buenos_Aires" {% if current_tz == 'America/Buenos_Aires' %}selected{% endif %}>America/Buenos_Aires</option>
                </optgroup>
                <optgroup label="Europe">
                    <option value="Europe/London" {% if current_tz == 'Europe/London' %}selected{% endif %}>Europe/London</option>
                    <option value="Europe/Paris" {% if current_tz == 'Europe/Paris' %}selected{% endif %}>Europe/Paris</option>
                    <option value="Europe/Berlin" {% if current_tz == 'Europe/Berlin' %}selected{% endif %}>Europe/Berlin</option>
                    <option value="Europe/Rome" {% if current_tz == 'Europe/Rome' %}selected{% endif %}>Europe/Rome</option>
                    <option value="Europe/Madrid" {% if current_tz == 'Europe/Madrid' %}selected{% endif %}>Europe/Madrid</option>
                    <option value="Europe/Amsterdam" {% if current_tz == 'Europe/Amsterdam' %}selected{% endif %}>Europe/Amsterdam</option>
                    <option value="Europe/Brussels" {% if current_tz == 'Europe/Brussels' %}selected{% endif %}>Europe/Brussels</option>
                    <option value="Europe/Warsaw" {% if current_tz == 'Europe/Warsaw' %}selected{% endif %}>Europe/Warsaw</option>
                    <option value="Europe/Moscow" {% if current_tz == 'Europe/Moscow' %}selected{% endif %}>Europe/Moscow</option>
                </optgroup>
                <optgroup label="Asia">
                    <option value="Asia/Dubai" {% if current_tz == 'Asia/Dubai' %}selected{% endif %}>Asia/Dubai</option>
                    <option value="Asia/Kolkata" {% if current_tz == 'Asia/Kolkata' %}selected{% endif %}>Asia/Kolkata</option>
                    <option value="Asia/Bangkok" {% if current_tz == 'Asia/Bangkok' %}selected{% endif %}>Asia/Bangkok</option>
                    <option value="Asia/Singapore" {% if current_tz == 'Asia/Singapore' %}selected{% endif %}>Asia/Singapore</option>
                    <option value="Asia/Hong_Kong" {% if current_tz == 'Asia/Hong_Kong' %}selected{% endif %}>Asia/Hong_Kong</option>
                    <option value="Asia/Shanghai" {% if current_tz == 'Asia/Shanghai' %}selected{% endif %}>Asia/Shanghai</option>
                    <option value="Asia/Tokyo" {% if current_tz == 'Asia/Tokyo' %}selected{% endif %}>Asia/Tokyo</option>
                    <option value="Asia/Seoul" {% if current_tz == 'Asia/Seoul' %}selected{% endif %}>Asia/Seoul</option>
                </optgroup>
                <optgroup label="Pacific">
                    <option value="Pacific/Auckland" {% if current_tz == 'Pacific/Auckland' %}selected{% endif %}>Pacific/Auckland</option>
                    <option value="Pacific/Fiji" {% if current_tz == 'Pacific/Fiji' %}selected{% endif %}>Pacific/Fiji</option>
                </optgroup>
                <optgroup label="Australia">
                    <option value="Australia/Sydney" {% if current_tz == 'Australia/Sydney' %}selected{% endif %}>Australia/Sydney</option>
                    <option value="Australia/Melbourne" {% if current_tz == 'Australia/Melbourne' %}selected{% endif %}>Australia/Melbourne</option>
                    <option value="Australia/Brisbane" {% if current_tz == 'Australia/Brisbane' %}selected{% endif %}>Australia/Brisbane</option>
                    <option value="Australia/Perth" {% if current_tz == 'Australia/Perth' %}selected{% endif %}>Australia/Perth</option>
                </optgroup>
                <optgroup label="Africa">
                    <option value="Africa/Cairo" {% if current_tz == 'Africa/Cairo' %}selected{% endif %}>Africa/Cairo</option>
                    <option value="Africa/Johannesburg" {% if current_tz == 'Africa/Johannesburg' %}selected{% endif %}>Africa/Johannesburg</option>
                </optgroup>
            </select>
            <p class="help-text">
                Timezone for full sync scheduling. Default is UTC.
            </p>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <button type="submit" class="btn">Save Configuration</button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary" style="text-decoration: none; display: inline-block;">Cancel</a>
        </div>
    </form>
</div>

<div class="card">
    <h2>Setup Instructions</h2>
    
    <h3 style="font-size: 16px; margin-bottom: 10px; margin-top: 20px;">1. Get Google Calendar Credentials</h3>
    <ol style="margin-left: 20px; line-height: 1.8;">
        <li>Go to <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
        <li>Create a new project or select an existing one</li>
        <li>Enable the Google Calendar API</li>
        <li>Create credentials:
            <ul style="margin-left: 20px; margin-top: 5px;">
                <li><strong>For Kubernetes:</strong> Create a Service Account and download the JSON key file</li>
                <li><strong>For local use:</strong> Create an OAuth 2.0 Client ID and download the credentials.json file</li>
            </ul>
        </li>
        <li>Mount the credentials file to <code>/app/secrets/credentials.json</code> in the container</li>
    </ol>
    
    <h3 style="font-size: 16px; margin-bottom: 10px; margin-top: 20px;">2. Find Your ICS Calendar URL</h3>
    <p>Most calendar applications provide an ICS export URL. Examples:</p>
    <ul style="margin-left: 20px; line-height: 1.8; margin-top: 10px;">
        <li><strong>Google Calendar:</strong> Calendar Settings → Integrate Calendar → Secret address in iCalendar format</li>
        <li><strong>Outlook/Office 365:</strong> Calendar Settings → Shared Calendars → Publish → ICS link</li>
        <li><strong>Apple Calendar:</strong> Calendar → Publish Calendar</li>
    </ul>
    
    <h3 style="font-size: 16px; margin-bottom: 10px; margin-top: 20px;">3. Service Account Permissions (Kubernetes)</h3>
    <p>If using a service account, make sure to:</p>
    <ul style="margin-left: 20px; line-height: 1.8; margin-top: 10px;">
        <li>Share the target Google Calendar with the service account email</li>
        <li>Give the service account "Make changes to events" permission</li>
    </ul>
</div>
{% endblock %}
